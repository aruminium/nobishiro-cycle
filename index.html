<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --bg-color: #fff6f9;
      --card-bg: #ffffff;
      --center-bg: #fffcef;
      --accent-color: #f5aac0;
      --text-color: #ee7d9b;
      --shadow-color: rgba(245, 170, 192, 0.3);
      --border-color: rgba(238, 125, 155, 0.2);
      --blue-accent: #7db9ee;
      --green-accent: #7deebb;
      --green-shadow: rgba(125, 238, 187, 0.3);
      --review-bg: #fef9e7; /* Light yellow for review */
      --review-border: #fbdc8e;
      --error-color: #ee7d7d;
    }
* {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Zen Maru Gothic', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      padding-bottom: 100px; /* Add padding for floating buttons */
      scroll-behavior: smooth;
      /* Ensure body takes up at least viewport height for screenshot */
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.2rem;
      color: var(--text-color);
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      color: var(--text-color);
      opacity: 0.8;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Storage message */
    .storage-note {
      background-color: rgba(245, 170, 192, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin: 20px auto;
      max-width: 800px;
      font-size: 0.9rem;
      color: var(--text-color);
      text-align: center;
      display: none; /* Initially hidden, shown by JS if needed */
    }

    .storage-note p {
      margin: 5px 0;
    }

    /* Tabs Navigation */
    .tabs-nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }

    .tab-button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding: 12px 20px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 30px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px var(--shadow-color);
      display: flex;
      align-items: center;
      gap: 6px;
      touch-action: manipulation;
    }

    .tab-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow-color);
    }

    .tab-button.active {
      background-color: var(--accent-color);
      color: white;
      box-shadow: 0 4px 10px var(--shadow-color);
      transform: translateY(0);
    }

    /* Tab Content */
    .tab-content {
      background-color: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 20px var(--shadow-color);
      margin-bottom: 40px;
      min-height: 60vh;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
      animation: fadeIn 0.4s ease-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
      font-size: 1.8rem;
      color: var(--text-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-description {
      font-size: 1rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 25px;
      max-width: 700px;
    }

    /* Cards Grid for AS-IS section */
    .asis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background-color: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 8px var(--shadow-color);
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px var(--shadow-color);
    }

    .tobe-card {
      background-color: var(--center-bg);
      border-color: var(--accent-color);
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--text-color);
    }

    .card-subtitle {
      font-size: 0.95rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 15px;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 10px;
      font-family: 'Zen Maru Gothic', sans-serif;
      resize: vertical;
      color: #555;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      flex-grow: 1;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px var(--shadow-color);
    }

    /* Navigation buttons */
    .tab-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .nav-button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding: 10px 20px;
      background-color: var(--blue-accent);
      color: white;
      border: none;
      border-radius: 30px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      touch-action: manipulation;
    }

    .nav-button:hover {
      background-color: #6baae0;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4);
    }

    .nav-button.prev {
      background-color: #aaa;
      box-shadow: 0 4px 8px rgba(170, 170, 170, 0.3);
    }

    .nav-button.prev:hover {
      background-color: #888;
      box-shadow: 0 6px 12px rgba(136, 136, 136, 0.4);
    }

    .nav-button.invisible {
      visibility: hidden;
    }

    /* Progress bar */
    .progress-container {
      margin: 0 auto 30px;
      width: 100%;
      max-width: 800px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: rgba(245, 170, 192, 0.2);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background-color: var(--accent-color);
      width: 0%;
      transition: width 0.5s ease;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--text-color);
      opacity: 0.8;
    }

    /* Floating Action Buttons Area */
    .fab-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column; /* Stack buttons vertically */
        gap: 10px; /* Space between buttons */
        z-index: 100;
    }

    .fab {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      padding: 10px 15px; /* Slightly smaller padding */
      color: white;
      border: none;
      border-radius: 30px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 0.9rem; /* Slightly smaller font */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: auto;
      min-width: 120px; /* Ensure text fits */
      height: 40px; /* Fixed height */
      text-align: center;
      touch-action: manipulation;
    }

    .fab:hover {
      transform: translateY(-2px) scale(1.05);
    }

    /* Individual FAB styles */
    .save-button-local {
      background-color: var(--accent-color);
      box-shadow: 0 4px 10px var(--shadow-color);
    }
    .save-button-local:hover { box-shadow: 0 6px 12px var(--shadow-color); }

    .download-button {
      background-color: var(--blue-accent);
      box-shadow: 0 4px 10px rgba(125, 185, 238, 0.3);
    }
    .download-button:hover { box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); }

    .upload-button {
       background-color: var(--green-accent);
       box-shadow: 0 4px 10px var(--green-shadow);
    }
    .upload-button:hover { box-shadow: 0 6px 12px var(--green-shadow); }


    /* Hidden file input */
    #fileInput {
        display: none;
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 150px; /* Adjust position above FABs */
      right: 20px;
      background-color: var(--accent-color);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      box-shadow: 0 4px 10px var(--shadow-color);
      transform: translateY(150px); /* Start further down */
      opacity: 0;
      transition: transform 0.4s ease-out, opacity 0.4s ease-out;
      z-index: 99;
      pointer-events: none;
    }
    .notification.upload-success {
        background-color: var(--green-accent);
        color: #333; /* Darker text for green bg */
        box-shadow: 0 4px 10px var(--green-shadow);
    }
    .notification.error {
        background-color: var(--error-color);
         box-shadow: 0 4px 10px rgba(238, 125, 125, 0.3);
    }


    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

     /* Action buttons within Check tab */
    .check-actions {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
        justify-content: center;
        gap: 15px; /* Space between buttons */
        margin-top: 2rem;
        margin-bottom: 1.5rem; /* Space before next section */
    }
    .check-actions button {
      padding: 10px 20px;
      color: white;
      border: none;
      border-radius: 30px;
      font-family: 'Zen Maru Gothic', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex; /* Use inline-flex */
      align-items: center;
      gap: 8px;
    }
    .check-actions button:hover {
       transform: translateY(-2px);
    }
    #generate-image-btn {
        background-color: var(--blue-accent);
        box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3);
    }
     #generate-image-btn:hover {
       background-color: #6baae0;
       box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4);
    }
     #generate-image-btn:disabled { background-color: #aaa; cursor: not-allowed; transform: none; box-shadow: none; }

    #reviewButton { /* New Review Button Style */
        background-color: var(--green-accent); /* Use green */
        color: #333; /* Darker text for green */
        box-shadow: 0 4px 8px var(--green-shadow);
    }
     #reviewButton:hover {
        background-color: #6bcdac; /* Darker green on hover */
        box-shadow: 0 6px 12px var(--green-shadow);
    }

    /* Review Summary Container */
    #review-summary-container {
        display: none; /* Hidden by default */
        margin-top: 2rem;
        padding: 25px;
        background-color: var(--review-bg);
        border: 1px solid var(--review-border);
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(251, 220, 142, 0.2);
        color: #555; /* Darker text for readability */
    }
    .review-section {
        margin-bottom: 20px;
    }
    .review-section:last-child {
        margin-bottom: 0;
    }
    .review-section-title {
        font-size: 1.3rem;
        font-weight: 500;
        color: var(--text-color); /* Use main text color for title */
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px dashed var(--accent-color);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .review-content {
        font-size: 0.95rem;
        line-height: 1.7;
        white-space: pre-wrap; /* Preserve line breaks and spaces */
        word-wrap: break-word; /* Break long words */
        background-color: rgba(255, 255, 255, 0.5); /* Slight white background */
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(238, 125, 155, 0.1);
    }
     .review-content.asis-item { /* Style for individual as-is items */
        margin-bottom: 10px;
        border-left: 3px solid var(--accent-color);
        padding-left: 15px;
     }
    .review-content.asis-item strong { /* Subtitle for as-is item */
        display: block;
        font-weight: 500;
        margin-bottom: 5px;
        color: var(--text-color);
        opacity: 0.9;
    }


    #review-image-container { display: none; text-align: center; margin-top: 1.5rem; background-color: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    #review-image { max-width: 100%; border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 1rem; }
    #review-image-container p { font-size: 0.9rem; margin-top: 1rem; color: var(--text-color); opacity: 0.9; line-height: 1.5; } /* Adjusted line-height */
    #tweet-btn { display: inline-block; margin-top: 1rem; padding: 10px 20px; background-color: #1DA1F2; color: white; border-radius: 30px; text-decoration: none; font-size: 1rem; font-family: 'Zen Maru Gothic', sans-serif; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(29, 161, 242, 0.3); }
    #tweet-btn:hover { background-color: #0c85d0; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(29, 161, 242, 0.4); }

    /* Responsive Styles */
    @media (max-width: 768px) {
        body { padding: 15px; padding-bottom: 120px; }
        .header h1 { font-size: 1.8rem; } .header p { font-size: 1rem; }
        .asis-grid { grid-template-columns: 1fr; }
        .section-title { font-size: 1.5rem; }
        .tab-button { font-size: 0.9rem; padding: 10px 15px; }
        .tab-content { padding: 20px; }
        .fab-container { right: 15px; bottom: 15px; }
        .fab { font-size: 0.85rem; padding: 8px 12px; min-width: 100px; height: 36px; gap: 5px; }
        .notification { font-size: 0.85rem; padding: 10px 15px; right: 15px; bottom: 150px; }
        #generate-image-btn, #tweet-btn, .nav-button, #reviewButton { font-size: 0.9rem; padding: 8px 16px; }
        .check-actions { gap: 10px; }
        .review-section-title { font-size: 1.2rem; }
        .review-content { font-size: 0.9rem; }
    }
    @media (max-width: 480px) {
        .header h1 { font-size: 1.6rem; }
        .tab-button { font-size: 0.85rem; padding: 8px 12px; }
        .fab { font-size: 0.8rem; min-width: 40px; width: 40px; height: 40px; border-radius: 50%; padding: 0; }
        .fab span { display: none; }
        .notification { width: calc(100% - 30px); left: 15px; right: 15px; text-align: center; bottom: 170px; }
        .check-actions button span { /* display: none; */ }
    }
    /* (åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« - çœç•¥) */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; padding: 20px; padding-bottom: 100px; scroll-behavior: smooth; min-height: 100vh; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: 2.2rem; color: var(--text-color); margin-bottom: 10px; }
    .header p { font-size: 1.1rem; color: var(--text-color); opacity: 0.8; max-width: 600px; margin: 0 auto; }
    .storage-note { background-color: rgba(245, 170, 192, 0.1); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin: 20px auto; max-width: 800px; font-size: 0.9rem; color: var(--text-color); text-align: center; display: none; }
    .storage-note p { margin: 5px 0; }
    .tabs-nav { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; }
    .tab-button { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 12px 20px; background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px var(--shadow-color); display: flex; align-items: center; gap: 6px; touch-action: manipulation; }
    .tab-button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); }
    .tab-button.active { background-color: var(--accent-color); color: white; box-shadow: 0 4px 10px var(--shadow-color); transform: translateY(0); }
    .tab-content { background-color: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 8px 20px var(--shadow-color); margin-bottom: 40px; min-height: 60vh; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .section-title { font-size: 1.8rem; color: var(--text-color); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    .section-description { font-size: 1rem; color: var(--text-color); opacity: 0.8; margin-bottom: 25px; max-width: 700px; }
    .asis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .card { background-color: var(--card-bg); border-radius: 15px; padding: 20px; box-shadow: 0 4px 8px var(--shadow-color); transition: all 0.3s ease; border: 1px solid var(--border-color); height: 100%; display: flex; flex-direction: column; margin-bottom: 20px; /* Add margin for spacing in capture */ }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px var(--shadow-color); }
    .tobe-card { background-color: var(--center-bg); border-color: var(--accent-color); }
    .card-title { font-size: 1.2rem; font-weight: 500; margin-bottom: 8px; color: var(--text-color); }
    .card-subtitle { font-size: 0.95rem; color: var(--text-color); opacity: 0.8; margin-bottom: 15px; }
    textarea { width: 100%; min-height: 150px; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; font-family: 'Zen Maru Gothic', sans-serif; resize: vertical; color: #555; font-size: 0.95rem; transition: all 0.3s ease; flex-grow: 1; }
    textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px var(--shadow-color); }
    .tab-navigation { display: flex; justify-content: space-between; margin-top: 30px; }
    .nav-button { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 10px 20px; background-color: var(--blue-accent); color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; touch-action: manipulation; }
    .nav-button:hover { background-color: #6baae0; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); }
    .nav-button.prev { background-color: #aaa; box-shadow: 0 4px 8px rgba(170, 170, 170, 0.3); }
    .nav-button.prev:hover { background-color: #888; box-shadow: 0 6px 12px rgba(136, 136, 136, 0.4); }
    .nav-button.invisible { visibility: hidden; }
    .progress-container { margin: 0 auto 30px; width: 100%; max-width: 800px; }
    .progress-bar { width: 100%; height: 8px; background-color: rgba(245, 170, 192, 0.2); border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.5s ease; }
    .progress-labels { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem; color: var(--text-color); opacity: 0.8; }
    .fab-container { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
    .fab { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 10px 15px; color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; transition: all 0.3s ease; width: auto; min-width: 120px; height: 40px; text-align: center; touch-action: manipulation; }
    .fab:hover { transform: translateY(-2px) scale(1.05); }
    .save-button-local { background-color: var(--accent-color); box-shadow: 0 4px 10px var(--shadow-color); }
    .save-button-local:hover { box-shadow: 0 6px 12px var(--shadow-color); }
    .download-button { background-color: var(--blue-accent); box-shadow: 0 4px 10px rgba(125, 185, 238, 0.3); }
    .download-button:hover { box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); }
    .upload-button { background-color: var(--green-accent); box-shadow: 0 4px 10px var(--green-shadow); }
    .upload-button:hover { box-shadow: 0 6px 12px var(--green-shadow); }
    #fileInput { display: none; }
    .notification { position: fixed; bottom: 150px; right: 20px; background-color: var(--accent-color); color: white; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; box-shadow: 0 4px 10px var(--shadow-color); transform: translateY(150px); opacity: 0; transition: transform 0.4s ease-out, opacity 0.4s ease-out; z-index: 99; pointer-events: none; }
    .notification.upload-success { background-color: var(--green-accent); color: #333; box-shadow: 0 4px 10px var(--green-shadow); }
    .notification.error { background-color: var(--error-color); box-shadow: 0 4px 10px rgba(238, 125, 125, 0.3); }
    .notification.show { transform: translateY(0); opacity: 1; }
    .check-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 2rem; margin-bottom: 1.5rem; }
    .check-actions button { padding: 10px 20px; color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
    .check-actions button:hover { transform: translateY(-2px); }
    #generate-image-btn { background-color: var(--blue-accent); box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3); }
    #generate-image-btn:hover { background-color: #6baae0; box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); }
    #generate-image-btn:disabled { background-color: #aaa; cursor: not-allowed; transform: none; box-shadow: none; }
    #reviewButton { background-color: var(--green-accent); color: #333; box-shadow: 0 4px 8px var(--green-shadow); }
    #reviewButton:hover { background-color: #6bcdac; box-shadow: 0 6px 12px var(--green-shadow); }
    #review-summary-container { display: none; margin-top: 2rem; padding: 25px; background-color: var(--review-bg); border: 1px solid var(--review-border); border-radius: 15px; box-shadow: 0 4px 10px rgba(251, 220, 142, 0.2); color: #555; }
    .review-section { margin-bottom: 20px; } .review-section:last-child { margin-bottom: 0; }
    .review-section-title { font-size: 1.3rem; font-weight: 500; color: var(--text-color); margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed var(--accent-color); display: flex; align-items: center; gap: 8px; }
    .review-content { font-size: 0.95rem; line-height: 1.7; white-space: pre-wrap; word-wrap: break-word; background-color: rgba(255, 255, 255, 0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(238, 125, 155, 0.1); }
    .review-content.asis-item { margin-bottom: 10px; border-left: 3px solid var(--accent-color); padding-left: 15px; }
    .review-content.asis-item strong { display: block; font-weight: 500; margin-bottom: 5px; color: var(--text-color); opacity: 0.9; }
    #review-image-container { display: none; text-align: center; margin-top: 1.5rem; background-color: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    #review-image { max-width: 100%; border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 1rem; }
    #review-image-container p { font-size: 0.9rem; margin-top: 1rem; color: var(--text-color); opacity: 0.9; line-height: 1.5; }
    #tweet-btn { display: inline-block; margin-top: 1rem; padding: 10px 20px; background-color: #1DA1F2; color: white; border-radius: 30px; text-decoration: none; font-size: 1rem; font-family: 'Zen Maru Gothic', sans-serif; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(29, 161, 242, 0.3); }
    #tweet-btn:hover { background-color: #0c85d0; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(29, 161, 242, 0.4); }

    /* Styles for the temporary capture container */
    #capture-temp-container {
        /* Ensure it doesn't inherit unwanted styles */
        all: initial;
        /* Apply necessary base styles */
        font-family: 'Zen Maru Gothic', sans-serif;
        color: var(--text-color);
        line-height: 1.6;
        box-sizing: border-box; /* Apply box-sizing */

        /* Layout styles */
        position: absolute;
        left: -9999px; /* Position off-screen */
        top: 0;
        width: 800px; /* Fixed width for consistent image size */
        padding: 30px;
        background-color: var(--card-bg); /* Use tab content background */
        border-radius: 20px;
        box-shadow: 0 8px 20px var(--shadow-color);
        overflow: hidden; /* Prevent content overflow issues */
    }
    /* Apply styles for elements inside the temporary container */
    #capture-temp-container * {
         box-sizing: border-box; /* Ensure box-sizing is inherited */
    }
    #capture-temp-container .section-title,
    #capture-temp-container .section-description,
    #capture-temp-container .card,
    #capture-temp-container .card-title,
    #capture-temp-container .card-subtitle,
    #capture-temp-container .review-summary-container, /* Style the cloned review container if needed */
    #capture-temp-container .review-section,
    #capture-temp-container .review-section-title,
    #capture-temp-container .review-content,
    #capture-temp-container textarea /* Apply textarea styles for KPT card */
    {
        /* Re-apply specific styles needed for capture, potentially inheriting less */
        font-family: inherit; /* Inherit from container */
        color: inherit; /* Inherit from container (or set specific) */
        /* Add other necessary styles like margin, padding, borders */
    }
    /* Replicate card styles */
    #capture-temp-container .card {
      background-color: var(--card-bg); border-radius: 15px; padding: 20px; box-shadow: 0 4px 8px var(--shadow-color); border: 1px solid var(--border-color); margin-bottom: 25px; /* Spacing */ display: flex; flex-direction: column;
    }
    #capture-temp-container .card-title { font-size: 1.2rem; font-weight: 500; margin-bottom: 8px; color: var(--text-color); }
    #capture-temp-container .card-subtitle { font-size: 0.95rem; color: var(--text-color); opacity: 0.8; margin-bottom: 15px; }
     #capture-temp-container textarea {
        width: 100%; min-height: 150px; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; resize: none; color: #555; font-size: 0.95rem; flex-grow: 1; background-color: #fff; /* Ensure background */ overflow-wrap: break-word; white-space: pre-wrap;
     }
    /* Replicate review summary styles */
    #capture-temp-container .review-summary-container-clone {
         margin-top: 30px; padding: 25px; background-color: var(--review-bg); border: 1px solid var(--review-border); border-radius: 15px; box-shadow: 0 4px 10px rgba(251, 220, 142, 0.2); color: #555;
    }
     #capture-temp-container .review-section { margin-bottom: 20px; } #capture-temp-container .review-section:last-child { margin-bottom: 0; }
     #capture-temp-container .review-section-title { font-size: 1.3rem; font-weight: 500; color: var(--text-color); margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed var(--accent-color); display: flex; align-items: center; gap: 8px; }
     #capture-temp-container .review-content { font-size: 0.95rem; line-height: 1.7; white-space: pre-wrap; word-wrap: break-word; background-color: rgba(255, 255, 255, 0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(238, 125, 155, 0.1); }
     #capture-temp-container .review-content.asis-item { margin-bottom: 10px; border-left: 3px solid var(--accent-color); padding-left: 15px; }
     #capture-temp-container .review-content.asis-item strong { display: block; font-weight: 500; margin-bottom: 5px; color: var(--text-color); opacity: 0.9; }


    /* Responsive Styles */
    @media (max-width: 768px) { /* ... (abbreviated) ... */
        body { padding: 15px; padding-bottom: 120px; } .header h1 { font-size: 1.8rem; } .header p { font-size: 1rem; } .asis-grid { grid-template-columns: 1fr; } .section-title { font-size: 1.5rem; } .tab-button { font-size: 0.9rem; padding: 10px 15px; } .tab-content { padding: 20px; } .fab-container { right: 15px; bottom: 15px; } .fab { font-size: 0.85rem; padding: 8px 12px; min-width: 100px; height: 36px; gap: 5px; } .notification { font-size: 0.85rem; padding: 10px 15px; right: 15px; bottom: 150px; } #generate-image-btn, #tweet-btn, .nav-button, #reviewButton { font-size: 0.9rem; padding: 8px 16px; } .check-actions { gap: 10px; } .review-section-title { font-size: 1.2rem; } .review-content { font-size: 0.9rem; }
        /* Adjust capture width for smaller screens if needed */
        #capture-temp-container { width: 90%; padding: 20px; }
    }
    @media (max-width: 480px) { /* ... (abbreviated) ... */
        .header h1 { font-size: 1.6rem; } .tab-button { font-size: 0.85rem; padding: 8px 12px; } .fab { font-size: 0.8rem; min-width: 40px; width: 40px; height: 40px; border-radius: 50%; padding: 0; } .fab span { display: none; } .notification { width: calc(100% - 30px); left: 15px; right: 15px; text-align: center; bottom: 170px; } .check-actions button span { /* display: none; */ }
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸŒ€ ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«</h1>
        <p>è‡ªå·±åˆ†æã¨è¡Œå‹•è¨­è¨ˆã®ãŸã‚ã®ã‚µã‚¤ã‚¯ãƒ«æ€è€ƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</p>
    </div>

    <div class="storage-note">
        <p>âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ã¯é™å®šçš„ã«å‹•ä½œã—ã¾ã™ã€‚</p>
        <p>â€»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆå»ã•ã‚Œã¾ã™ã€‚</p>
        <p>å®Œå…¨ãªæ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆã¯ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
    </div>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="progress-labels">
            <span>ã‚µã‚¤ã‚¯ãƒ«é€²è¡ŒçŠ¶æ³</span>
            <span id="progressText">0%</span>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-nav" id="tabsNav">
        <button class="tab-button active" data-tab="tobe">ğŸŒˆ <span>TO-BE</span></button>
        <button class="tab-button" data-tab="asis">ğŸ” <span>AS-IS</span></button>
        <button class="tab-button" data-tab="rule">âŒ <span>RULE</span></button>
        <button class="tab-button" data-tab="perk">ğŸ§° <span>PERK</span></button>
        <button class="tab-button" data-tab="action">ğŸ›  <span>ACTION</span></button>
        <button class="tab-button" data-tab="check">âœ… <span>CHECK</span></button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- TO-BE Tab -->
        <div class="tab-panel active" id="tobe-panel">
            <h2 class="section-title">ğŸŒˆ TO-BEï¼ˆãªã‚ŠãŸã„å§¿ãƒ»ç†æƒ³ã®çŠ¶æ…‹ï¼‰</h2>
            <p class="section-description">ãƒ¯ã‚¯ãƒ¯ã‚¯ã§ãã‚‹æœªæ¥ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¾ã—ã‚‡ã†ã€‚ã‚ãªãŸã®ç›®æŒ‡ã—ãŸã„çŠ¶æ…‹ãƒ»ã‚ã‚ŠãŸã„å§¿ã¯ã©ã‚“ãªã‚‚ã®ã§ã™ã‹ï¼Ÿ</p>
            <div class="card tobe-card">
                <h3 class="card-title">ç†æƒ³ã®çŠ¶æ…‹ã‚’æã</h3>
                <p class="card-subtitle">ç›®æ¨™ã§ã¯ãªãã€ã©ã‚“ãªé¢¨ã«ç”Ÿãã¦ã„ãŸã„ã‹ã€ã‚ã‚Šæ–¹ã‚’æã„ã¦ã¿ã‚ˆã†</p>
                <textarea data-section="tobe" id="tobe-input" placeholder="ã“ã‚“ãªãµã†ã«ç”ŸããŸã„ï¼ã©ã‚“ãªçŠ¶æ…‹ãŒç†æƒ³ï¼Ÿ"></textarea>
            </div>
            <div class="tab-navigation">
                <button class="nav-button prev invisible">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next" data-next="asis"><span>æ¬¡ã¸</span> â–¶</button>
            </div>
        </div>

        <!-- AS-IS Tab -->
        <div class="tab-panel" id="asis-panel">
            <h2 class="section-title">ğŸ” AS-ISï¼ˆç¾çŠ¶åˆ†æï¼‰</h2>
            <p class="section-description">ç¾çŠ¶ã‚’å¤šè§’çš„ã«æ£šå¸ã—ã¾ã—ã‚‡ã†ã€‚è‡ªåˆ†è‡ªèº«ã‚„ç’°å¢ƒã‚’å®¢è¦³çš„ã«è¦‹ã¤ã‚ã‚‹ã“ã¨ã§ã€æ¬¡ã®ä¸€æ‰‹ãŒè¦‹ãˆã¦ãã¾ã™ã€‚</p>
            <div class="asis-grid">
                <div class="card">
                    <h3 class="card-title">ã€Œç†æƒ³ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ã€</h3>
                    <p class="card-subtitle">ç†æƒ³ã¨æ¯”ã¹ã¦ä»Šã®è‡ªåˆ†ã¯ã©ã†ï¼Ÿ</p>
                    <textarea data-section="asis" id="asis-gap" placeholder="ç†æƒ³ã¨æ¯”ã¹ã¦ã€ã©ã“ã§å¼•ã£ã‹ã‹ã£ã¦ã‚‹ï¼Ÿ"></textarea>
                </div>
                <div class="card">
                    <h3 class="card-title">ã€Œèª²é¡Œãƒ»ã¤ã¾ãšãã€</h3>
                    <p class="card-subtitle">æœ€è¿‘ã—ã‚“ã©ã„ã“ã¨ãƒ»æ­¢ã¾ã£ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ</p>
                    <textarea data-section="asis" id="asis-challenges" placeholder="ã©ã“ã§ã¤ã¾ãšã„ã¦ã‚‹ï¼Ÿä½•ãŒé›£ã—ã„ï¼Ÿ"></textarea>
                </div>
                <div class="card">
                    <h3 class="card-title">ã€Œæ„Ÿæƒ…ãƒ»ä¸å®‰ãƒ»ç„¦ã‚Šã€</h3>
                    <p class="card-subtitle">ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã¦ã‚‹ã“ã¨ã¯ï¼Ÿ</p>
                    <textarea data-section="asis" id="asis-emotions" placeholder="ãªã‚“ã¨ãªãä¸å®‰ãªã“ã¨ã€ã¼ã‚“ã‚„ã‚Šã§ã‚‚OKã§ã™"></textarea>
                </div>
                <div class="card">
                    <h3 class="card-title">ã€Œå¤–çš„ãªåˆ¶ç´„ã€</h3>
                    <p class="card-subtitle">è‡ªåˆ†ã§ã¯å‹•ã‹ã›ãªã„ç’°å¢ƒè¦å› ã£ã¦ï¼Ÿ</p>
                    <textarea data-section="asis" id="asis-constraints" placeholder="å‘¨ã‚Šã®çŠ¶æ³ã§å¤‰ãˆã‚‰ã‚Œãªã„ã“ã¨ã¯ï¼Ÿ"></textarea>
                </div>
                <div class="card">
                    <h3 class="card-title">ã€Œéå»ã®å½±éŸ¿ãƒ»ãƒˆãƒ©ã‚¦ãƒã€</h3>
                    <p class="card-subtitle">æ˜”ã®çµŒé¨“ãŒä»Šã®è¡Œå‹•ã«å½±éŸ¿ã—ã¦ã‚‹ï¼Ÿ</p>
                    <textarea data-section="asis" id="asis-past" placeholder="éå»ã®çµŒé¨“ã§ä»Šã‚‚å½±éŸ¿ã—ã¦ã‚‹ã“ã¨ã‚ã‚‹ï¼Ÿ"></textarea>
                </div>
            </div>
            <div class="tab-navigation">
                <button class="nav-button prev" data-prev="tobe">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next" data-next="rule"><span>æ¬¡ã¸</span> â–¶</button>
            </div>
        </div>

        <!-- RULE Tab -->
        <div class="tab-panel" id="rule-panel">
             <h2 class="section-title">âŒ RULEï¼ˆã‚„ã‚‰ãªã„ã“ã¨ãƒ»é¿ã‘ãŸã„æ–¹å‘ï¼‰</h2>
            <p class="section-description">è‡ªåˆ†ã‚’å®ˆã‚‹ãŸã‚ã®å¢ƒç•Œç·šã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚ã€Œã‚‚ã†ã“ã‚Œã¯ã‚„ã‚‰ãªã„ã€ã¨æ±ºã‚ã‚‹ã“ã¨ã§ã€åŠ¹ç‡çš„ã«å‰ã«é€²ã‚ã¾ã™ã€‚</p>
            <div class="card">
                <h3 class="card-title">è‡ªåˆ†ã‚’å®ˆã‚‹è¨­è¨ˆ</h3>
                <p class="card-subtitle">ç„¡ç†ã—ãªã„ãŸã‚ã®"ã‚„ã‚‰ãªã„å®£è¨€"ã‚’æ›¸ã“ã†</p>
                <textarea data-section="rule" id="rule-input" placeholder="ã“ã‚Œã¯ã‚‚ã†ã‚„ã‚‰ãªã„ã€é¿ã‘ãŸã„ã“ã¨ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†"></textarea>
            </div>
            <div class="tab-navigation">
                <button class="nav-button prev" data-prev="asis">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next" data-next="perk"><span>æ¬¡ã¸</span> â–¶</button>
            </div>
        </div>

        <!-- PERK Tab -->
        <div class="tab-panel" id="perk-panel">
             <h2 class="section-title">ğŸ§° PERKï¼ˆä½¿ãˆã‚‹è£…å‚™ï¼‰</h2>
            <p class="section-description">ä»Šã®è‡ªåˆ†ãŒæŒã¤å¼·ã¿ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‚ã¾ã—ã‚‡ã†ã€‚æ—¢ã«æ‰‹ã«å…¥ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚„çµŒé¨“ã€äººè„ˆã‚‚å¤§åˆ‡ãªè£…å‚™ã§ã™ã€‚</p>
            <div class="card">
                <h3 class="card-title">è‡ªåˆ†ã®è£…å‚™ã‚’è¦‹ã¤ã‚ã‚‹</h3>
                <p class="card-subtitle">ä»Šã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“ãƒ»çŸ¥è­˜ã‚’æ£šå¸ã—ã™ã‚‹</p>
                <textarea data-section="perk" id="perk-input" placeholder="ä»Šã®è‡ªåˆ†ã«ã‚ã‚‹æ­¦å™¨ã£ã¦ï¼Ÿä½¿ãˆã‚‹ã‚¹ã‚­ãƒ«ã¯ï¼Ÿ"></textarea>
            </div>
            <div class="tab-navigation">
                <button class="nav-button prev" data-prev="rule">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next" data-next="action"><span>æ¬¡ã¸</span> â–¶</button>
            </div>
        </div>

        <!-- ACTION Tab -->
        <div class="tab-panel" id="action-panel">
             <h2 class="section-title">ğŸ›  ACTIONï¼ˆæ‰‹æ®µãƒ»è¡Œå‹•ï¼‰</h2>
            <p class="section-description">ç†æƒ³ã«è¿‘ã¥ããŸã‚ã®å…·ä½“çš„ãªä¸€æ­©ã‚’è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚TO-BEã«è¿‘ã¥ããŸã‚ã«ã€ä»Šã®è‡ªåˆ†ã«ã§ãã‚‹ã“ã¨ã¯ä½•ã§ã—ã‚‡ã†ï¼Ÿ</p>
            <div class="card">
                <h3 class="card-title">æ¬¡ã®ä¸€æ‰‹ã‚’è€ƒãˆã‚‹</h3>
                <p class="card-subtitle">ç†æƒ³ã«è¿‘ã¥ããŸã‚ã«ä»Šã§ãã‚‹ã“ã¨ã¯ï¼Ÿ</p>
                <textarea data-section="action" id="action-input" placeholder="å…·ä½“çš„ã«ä½•ã‚’ã™ã‚‹ï¼Ÿã„ã¤ã¾ã§ã«ï¼Ÿã©ã†ã‚„ã£ã¦ï¼Ÿ"></textarea>
            </div>
            <div class="tab-navigation">
                <button class="nav-button prev" data-prev="perk">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next" data-next="check"><span>æ¬¡ã¸</span> â–¶</button>
            </div>
        </div>

        <!-- CHECK Tab -->
        <div class="tab-panel" id="check-panel">
            <h2 class="section-title">âœ… CHECKï¼ˆæŒ¯ã‚Šè¿”ã‚Šï¼‰</h2>
            <p class="section-description">è¡Œå‹•ã®çµæœã‚’æŒ¯ã‚Šè¿”ã‚Šã€æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ãªã’ã¾ã—ã‚‡ã†ã€‚ã†ã¾ãã„ã£ãŸã“ã¨ã€æ”¹å–„ç‚¹ã€æ¬¡ã«è©¦ã—ãŸã„ã“ã¨ã‚’æ•´ç†ã—ã¾ã™ã€‚</p>
            <div class="card">
                <h3 class="card-title">KPTã§æŒ¯ã‚Šè¿”ã‚‹</h3>
                <p class="card-subtitle">Keepï¼Problemï¼Tryã§æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ãªã’ã‚ˆã†</p>
                <textarea data-section="check" id="check-input" placeholder="ã‚ˆã‹ã£ãŸã“ã¨(Keep)ï¼æ”¹å–„ç‚¹(Problem)ï¼æ¬¡ã«ã‚„ã£ã¦ã¿ã‚‹ã“ã¨(Try)"></textarea>
            </div>

            <!-- Action Buttons Area -->
            <div class="check-actions">
                <button id="reviewButton">ğŸ“ <span>å…¥åŠ›å†…å®¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼</span></button>
                <button id="generate-image-btn">ğŸ–¼ï¸ <span>ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’ç”»åƒåŒ–</span></button> <!-- Changed text -->
            </div>

            <!-- Review Summary Container -->
            <div id="review-summary-container">
                <!-- Review content will be injected here by JS -->
            </div>

            <!-- Image Generation Output -->
            <div id="review-image-container">
                <img alt="ã®ã³ã—ã‚è¨˜éŒ²ãƒ¬ãƒ“ãƒ¥ãƒ¼" id="review-image" src=""/> <!-- Alt text changed -->
                 <p id="image-save-instruction">
                    <!-- Instruction text will be updated by JS -->
                 </p>
                <a href="#" id="tweet-btn" target="_blank" rel="noopener noreferrer">
                    ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹
                </a>
            </div>

            <!-- Tab Navigation -->
             <div class="tab-navigation" style="margin-top: 2rem;">
                <button class="nav-button prev" data-prev="action">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next restart" data-next="tobe"><span>ã‚µã‚¤ã‚¯ãƒ«å†å§‹å‹•</span> ğŸ”„</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <button class="fab save-button-local" id="saveButtonLocal">ğŸ’¾ <span>ä¿å­˜(ï¾›ï½°ï½¶ï¾™)</span></button>
        <button class="fab download-button" id="downloadButton">ğŸ’¾ <span>DL(ï¾Œï½§ï½²ï¾™)</span></button>
        <button class="fab upload-button" id="uploadButton">ğŸ“¤ <span>UL(èª­è¾¼)</span></button>
    </div>
    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept=".json">

    <!-- Notifications -->
    <div class="notification" id="saveNotificationLocal">ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸï¼</div>
    <div class="notification upload-success" id="uploadNotificationSuccess">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼</div>
    <div class="notification error" id="uploadNotificationError">ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>

</div>

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- Main Application Logic -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // --- Element References ---
    const tabsNav = document.getElementById('tabsNav'); /* ... other refs */
    const tabButtons = tabsNav.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');
    const textareas = document.querySelectorAll('textarea');
    const saveButtonLocal = document.getElementById('saveButtonLocal');
    const downloadButton = document.getElementById('downloadButton');
    const uploadButton = document.getElementById('uploadButton');
    const fileInput = document.getElementById('fileInput');
    const saveNotificationLocal = document.getElementById('saveNotificationLocal');
    const uploadNotificationSuccess = document.getElementById('uploadNotificationSuccess');
    const uploadNotificationError = document.getElementById('uploadNotificationError');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const storageNote = document.querySelector('.storage-note');
    const generateBtn = document.getElementById('generate-image-btn');
    const outputContainer = document.getElementById('review-image-container');
    const outputImg = document.getElementById('review-image');
    const tweetBtn = document.getElementById('tweet-btn');
    const reviewButton = document.getElementById('reviewButton');
    const reviewSummaryContainer = document.getElementById('review-summary-container');
    const imageSaveInstruction = document.getElementById('image-save-instruction');

    // --- State Variables ---
    const tabOrder = ['tobe', 'asis', 'rule', 'perk', 'action', 'check']; /* ... other vars */
    const reviewSections = {
        'tobe': { title: 'ğŸŒˆ TO-BEï¼ˆãªã‚ŠãŸã„å§¿ãƒ»ç†æƒ³ã®çŠ¶æ…‹ï¼‰', ids: ['tobe-input'] },
        'asis': { title: 'ğŸ” AS-ISï¼ˆç¾çŠ¶åˆ†æï¼‰', ids: ['asis-gap', 'asis-challenges', 'asis-emotions', 'asis-constraints', 'asis-past'] },
        'rule': { title: 'âŒ RULEï¼ˆã‚„ã‚‰ãªã„ã“ã¨ãƒ»é¿ã‘ãŸã„æ–¹å‘ï¼‰', ids: ['rule-input'] },
        'perk': { title: 'ğŸ§° PERKï¼ˆä½¿ãˆã‚‹è£…å‚™ï¼‰', ids: ['perk-input'] },
        'action': { title: 'ğŸ›  ACTIONï¼ˆæ‰‹æ®µãƒ»è¡Œå‹•ï¼‰', ids: ['action-input'] },
    };
    let currentTabIndex = 0;
    let isLocalStorageAvailable = true;
    let notificationTimeout;

    // --- Helper Functions ---
    function getLocalStorageKey(textareaElement) { /* ... (same as before) ... */
        const section = textareaElement.dataset.section; const id = textareaElement.id; if (section && id) return `arumi_${section}_${id}`; console.warn('Missing data-section or id:', textareaElement); return null;
    }
    function showNotification(element, duration = 2000) { /* ... (same as before) ... */
        if (notificationTimeout) clearTimeout(notificationTimeout); [saveNotificationLocal, uploadNotificationSuccess, uploadNotificationError].forEach(el => el.classList.remove('show')); element.classList.add('show'); notificationTimeout = setTimeout(() => element.classList.remove('show'), duration);
    }

    // --- LocalStorage Functions ---
    function checkLocalStorage() { /* ... (same as before) ... */
        try { localStorage.setItem('__arumi_test__', '__test__'); localStorage.removeItem('__arumi_test__'); isLocalStorageAvailable = true; storageNote.style.display = 'none'; console.info('LocalStorage available.'); }
        catch (e) { isLocalStorageAvailable = false; storageNote.style.display = 'block'; console.warn('LocalStorage unavailable.'); if (saveButtonLocal) { saveButtonLocal.disabled = true; saveButtonLocal.style.opacity = 0.5; saveButtonLocal.style.cursor = 'not-allowed'; }}
    }
    function saveInputsToLocal() { /* ... (same as before) ... */
        if (!isLocalStorageAvailable) return false; let changed = false; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) { const current = localStorage.getItem(key); if (current !== ta.value) { localStorage.setItem(key, ta.value); changed = true; } } }); if (changed) console.log('Inputs saved to localStorage.'); return changed;
    }
    function restoreInputsFromLocal() { /* ... (same as before) ... */
        if (!isLocalStorageAvailable) return; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) { const saved = localStorage.getItem(key); if (saved !== null) ta.value = saved; } }); console.log('Inputs restored from localStorage.');
    }

    // --- File Download/Upload Functions ---
    function getAllInputsData() { /* ... (same as before) ... */
        const data = {}; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) data[key] = ta.value; }); return data;
    }
    function downloadDataAsFile() { /* ... (same as before) ... */
        const data = getAllInputsData(); const jsonData = JSON.stringify(data, null, 2); const blob = new Blob([jsonData], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; const ts = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-'); a.download = `nobishiro_cycle_data_${ts}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); console.log('Data downloaded.');
    }
    function restoreInputsFromFileData(data) { /* ... (same as before) ... */
        let count = 0; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key && data.hasOwnProperty(key)) { ta.value = data[key]; count++; } }); console.log(`Restored ${count} inputs from file.`); saveInputsToLocal();
    }
    function handleFileUpload(event) { /* ... (same as before) ... */
        const file = event.target.files[0]; if (!file) return; if (file.type !== 'application/json') { showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; fileInput.value = ''; return; } const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); restoreInputsFromFileData(data); showNotification(uploadNotificationSuccess, 2000); uploadNotificationSuccess.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼'; } catch (error) { console.error('File parse error:', error); showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚'; } finally { fileInput.value = ''; } }; reader.onerror = () => { console.error('File read error'); showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'; fileInput.value = ''; }; reader.readAsText(file);
    }

    // --- UI Update Functions ---
    function updateProgress() { /* ... (same as before) ... */
        const progress = ((currentTabIndex + 1) / tabOrder.length) * 100; progressBar.style.width = `${progress}%`; progressText.textContent = `${Math.round(progress)}%`;
    }

    function showTab(tabId) { /* ... (modified) ... */
      const targetIndex = tabOrder.indexOf(tabId); if (targetIndex === -1) { console.error(`Tab ID "${tabId}" not found.`); return; } currentTabIndex = targetIndex;
      tabButtons.forEach((button, index) => button.classList.toggle('active', index === currentTabIndex));
      tabPanels.forEach((panel, index) => { const panelId = tabOrder[index]; if (panel.id === `${panelId}-panel`) panel.classList.toggle('active', index === currentTabIndex); });
      updateProgress(); outputContainer.style.display = "none"; outputImg.src = ""; reviewSummaryContainer.style.display = "none"; generateBtn.textContent = 'ğŸ–¼ï¸ ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’ç”»åƒåŒ–'; generateBtn.disabled = false;
    }

    // --- Review Summary Function ---
    function displayReviewSummary() { /* ... (modified for robustness) ... */
        saveInputsToLocal(); // Save current state before reviewing
        let summaryHTML = ''; let hasContent = false;

        for (const sectionKey in reviewSections) {
            if (!reviewSections.hasOwnProperty(sectionKey)) continue; // Ensure own properties

            const sectionInfo = reviewSections[sectionKey];
            let sectionContentHTML = '';
            let sectionHasContent = false;

            if (sectionKey === 'asis') {
                // Special handling for multiple AS-IS textareas
                sectionInfo.ids.forEach(id => {
                    const textarea = document.getElementById(id);
                    const card = textarea ? textarea.closest('.card') : null;
                    // Use card title as a fallback if subtitle is missing
                    const subtitle = card ? (card.querySelector('.card-subtitle')?.textContent || card.querySelector('.card-title')?.textContent || '') : '';
                    const value = textarea ? textarea.value.trim() : '';
                    if (value) { // Only show if there's content
                        sectionContentHTML += `<div class="review-content asis-item">`;
                        sectionContentHTML += `<strong>${subtitle.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</strong>`; // Add subtitle
                        sectionContentHTML += `${value.replace(/</g, "&lt;").replace(/>/g, "&gt;")}`; // Basic escaping
                        sectionContentHTML += `</div>`;
                        sectionHasContent = true;
                    }
                });
                 if (!sectionHasContent) {
                     sectionContentHTML += `<div class="review-content">ï¼ˆæœªå…¥åŠ›ï¼‰</div>`;
                 }

            } else {
                // Handling for single textarea sections
                const textarea = document.getElementById(sectionInfo.ids[0]);
                const value = textarea ? textarea.value.trim() : '';
                 sectionContentHTML += `<pre class="review-content">${value ? value.replace(/</g, "&lt;").replace(/>/g, "&gt;") : 'ï¼ˆæœªå…¥åŠ›ï¼‰'}</pre>`;
                 if (value) sectionHasContent = true;
            }

            // Only add the section if it has content OR it's a mandatory section (e.g., TO-BE)
            // For simplicity, we'll show all sections for now, even if empty.
             summaryHTML += `<div class="review-section">`;
             summaryHTML += `<h4 class="review-section-title">${sectionInfo.title}</h4>`;
             summaryHTML += sectionContentHTML;
             summaryHTML += `</div>`;
             if (sectionHasContent) hasContent = true; // Mark that at least one section has content
        }

        reviewSummaryContainer.innerHTML = summaryHTML;
        reviewSummaryContainer.style.display = 'block';
        outputContainer.style.display = "none"; // Hide image if shown

        // Scroll to the review section
        reviewSummaryContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        console.log('Review summary displayed.');
    }


    // --- Event Listeners ---

    // Tab Button Clicks
    tabButtons.forEach(button => button.addEventListener('click', () => { const id = button.dataset.tab; if (id) showTab(id); }));

    // Navigation Button Clicks (Next/Prev)
    document.querySelectorAll('.nav-button').forEach(button => { /* ... (same as before) ... */
        button.addEventListener('click', () => { let nextTabId = null; const isNext = button.classList.contains('next'); const isPrev = button.classList.contains('prev'); const isRestart = button.classList.contains('restart'); if (isNext && !isRestart && currentTabIndex < tabOrder.length - 1) nextTabId = tabOrder[currentTabIndex + 1]; else if (isPrev && currentTabIndex > 0) nextTabId = tabOrder[currentTabIndex - 1]; else if (isRestart) nextTabId = tabOrder[0]; if (nextTabId) { showTab(nextTabId); const ct = document.querySelector('.container').offsetTop; window.scrollTo({ top: ct - 20, behavior: 'smooth' }); } });
    });

    // Local Save Button Click
    if (saveButtonLocal) saveButtonLocal.addEventListener('click', () => { if (isLocalStorageAvailable && saveInputsToLocal()) showNotification(saveNotificationLocal, 2000); });
    // Download Button Click
    if (downloadButton) downloadButton.addEventListener('click', downloadDataAsFile);
    // Upload Button Click -> Trigger File Input
    if (uploadButton && fileInput) uploadButton.addEventListener('click', () => fileInput.click());
    // File Input Change (File Selected)
    if (fileInput) fileInput.addEventListener('change', handleFileUpload);

    // Textarea Auto-save on Input (throttled)
    let debounceTimer; textareas.forEach(ta => ta.addEventListener('input', () => { clearTimeout(debounceTimer); debounceTimer = setTimeout(saveInputsToLocal, 500); }));

    // Review Button Click
    if (reviewButton) reviewButton.addEventListener('click', displayReviewSummary);

    // Generate Image Button Click (Captures specific elements)
    if (generateBtn) {
        generateBtn.addEventListener('click', () => {
            // 1. Check if review is displayed
            if (reviewSummaryContainer.style.display !== 'block') {
                alert('å…ˆã«ã€Œå…¥åŠ›å†…å®¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            saveInputsToLocal(); // Save current state

            generateBtn.textContent = 'ç”»åƒç”Ÿæˆä¸­...';
            generateBtn.disabled = true;

            // 2. Create temporary container
            const tempContainer = document.createElement('div');
            tempContainer.id = 'capture-temp-container';
            // Styles are applied via CSS using the ID

            // 3. Clone required elements and append to temp container
            const checkPanel = document.getElementById('check-panel');
            const title = checkPanel.querySelector('.section-title');
            const description = checkPanel.querySelector('.section-description');
            const kptCard = checkPanel.querySelector('.card'); // KPT card

            if (title) tempContainer.appendChild(title.cloneNode(true));
            if (description) tempContainer.appendChild(description.cloneNode(true));
            if (kptCard) {
                const clonedKptCard = kptCard.cloneNode(true);
                // Ensure textarea value is visible in the clone (important!)
                const originalTextarea = kptCard.querySelector('textarea');
                const clonedTextarea = clonedKptCard.querySelector('textarea');
                if (originalTextarea && clonedTextarea) {
                    clonedTextarea.value = originalTextarea.value; // Copy value explicitly
                    clonedTextarea.style.height = originalTextarea.scrollHeight + 'px'; // Try to set height
                }
                 tempContainer.appendChild(clonedKptCard);
            }

            // Clone the displayed review container
            const clonedReview = reviewSummaryContainer.cloneNode(true);
            clonedReview.style.display = 'block'; // Ensure it's visible
            clonedReview.id = ''; // Avoid duplicate IDs
            clonedReview.classList.add('review-summary-container-clone'); // Add class for styling in capture
            tempContainer.appendChild(clonedReview);

            // 4. Append temp container to body (off-screen)
            document.body.appendChild(tempContainer);

            // 5. html2canvas capture
             const options = {
                scale: window.devicePixelRatio || 1.5, // Higher resolution
                useCORS: true,
                backgroundColor: null, // Background set on the container CSS
                logging: false,
                scrollX: 0, // Reset scroll for the temp container
                scrollY: 0,
                windowWidth: tempContainer.scrollWidth, // Use container's width/height
                windowHeight: tempContainer.scrollHeight
             };

            setTimeout(() => { // Delay for rendering
                 html2canvas(tempContainer, options).then(canvas => {
                     const dataURL = canvas.toDataURL("image/png", 0.95);
                     outputImg.src = dataURL;
                     outputContainer.style.display = "block";

                     const tweetText = "ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«ã§æŒ¯ã‚Šè¿”ã‚Šï¼†ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ #ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«";
                     tweetBtn.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;

                     if (imageSaveInstruction) {
                         imageSaveInstruction.innerHTML = `
                            ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’å«ã‚€ç”»åƒï¼‰<br/>
                            ğŸ“² <strong>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜</strong> ã—ã¦ã€<br/>
                            ãƒ„ã‚¤ãƒ¼ãƒˆã«æ·»ä»˜ã—ã¦æŠ•ç¨¿ã—ã¦ã­ï¼<br/>
                            ğŸ’» PC: <strong>å³ã‚¯ãƒªãƒƒã‚¯ â†’ åå‰ã‚’ã¤ã‘ã¦ç”»åƒã‚’ä¿å­˜</strong>
                         `;
                     }

                     outputContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                     generateBtn.textContent = 'ğŸ–¼ï¸ ç”»åƒã‚’å†ç”Ÿæˆ';

                 }).catch(error => {
                     console.error('html2canvas failed:', error);
                     alert('ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nå†…å®¹ãŒè¤‡é›‘ã™ãã‚‹ã‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                     generateBtn.textContent = 'ğŸ”„ ç”»åƒç”Ÿæˆå†è©¦è¡Œ';
                 }).finally(() => {
                     // 6. Remove temp container
                     document.body.removeChild(tempContainer);
                     generateBtn.disabled = false;
                 });
            }, 150); // Adjust delay if needed

        });
    } else { console.error('Generate image button not found.'); }


    // --- Initial Setup ---
    checkLocalStorage();
    restoreInputsFromLocal();
    showTab(tabOrder[0]);

  });
</script>

</body>
</html>
