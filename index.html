<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root { /* Color variables (unchanged) */
      --bg-color: #fff6f9; --card-bg: #ffffff; --center-bg: #fffcef; --accent-color: #f5aac0; --text-color: #ee7d9b; --shadow-color: rgba(245, 170, 192, 0.3); --border-color: rgba(238, 125, 155, 0.2); --blue-accent: #7db9ee; --green-accent: #7deebb; --green-shadow: rgba(125, 238, 187, 0.3); --review-bg: #fef9e7; --review-border: #fbdc8e; --error-color: #ee7d7d; --error-shadow: rgba(238, 125, 125, 0.3); --info-color: #7db9ee; --info-shadow: rgba(125, 185, 238, 0.3); --placeholder-color: #999; --textarea-text-color: #555;
    }
    /* --- Base Styles (unchanged) --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; padding: 20px; padding-bottom: 140px; scroll-behavior: smooth; min-height: 100vh; }
    .container { max-width: 1000px; margin: 0 auto; }
    /* --- Other general styles (unchanged) --- */
    .header { text-align: center; margin-bottom: 30px; } .header h1 { font-size: 2.2rem; color: var(--text-color); margin-bottom: 10px; } .header p { font-size: 1.1rem; color: var(--text-color); opacity: 0.8; max-width: 600px; margin: 0 auto; }
    .storage-note { background-color: rgba(245, 170, 192, 0.1); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin: 20px auto; max-width: 800px; font-size: 0.9rem; color: var(--text-color); text-align: center; display: none; } .storage-note p { margin: 5px 0; }
    .progress-container { margin: 0 auto 30px; width: 100%; max-width: 800px; } .progress-bar { width: 100%; height: 8px; background-color: rgba(245, 170, 192, 0.2); border-radius: 4px; overflow: hidden; } .progress-fill { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.5s ease; } .progress-labels { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem; color: var(--text-color); opacity: 0.8; }
    .tabs-nav { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; } .tab-button { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 12px 20px; background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px var(--shadow-color); display: flex; align-items: center; gap: 6px; touch-action: manipulation; } .tab-button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); } .tab-button.active { background-color: var(--accent-color); color: white; box-shadow: 0 4px 10px var(--shadow-color); transform: translateY(0); }
    .tab-content { background-color: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 8px 20px var(--shadow-color); margin-bottom: 40px; min-height: 60vh; } .tab-panel { display: none; } .tab-panel.active { display: block; animation: fadeIn 0.4s ease-out forwards; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .section-title { font-size: 1.8rem; color: var(--text-color); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; } .section-description { font-size: 1rem; color: var(--text-color); opacity: 0.8; margin-bottom: 25px; max-width: 700px; }
    .asis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; } .card { background-color: var(--card-bg); border-radius: 15px; padding: 20px; box-shadow: 0 4px 8px var(--shadow-color); transition: all 0.3s ease; border: 1px solid var(--border-color); height: 100%; display: flex; flex-direction: column; margin-bottom: 20px; } .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px var(--shadow-color); } .tobe-card { background-color: var(--center-bg); border-color: var(--accent-color); } .card-title { font-size: 1.2rem; font-weight: 500; margin-bottom: 8px; color: var(--text-color); } .card-subtitle { font-size: 0.95rem; color: var(--text-color); opacity: 0.8; margin-bottom: 15px; } textarea { width: 100%; min-height: 150px; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; font-family: 'Zen Maru Gothic', sans-serif; resize: vertical; color: var(--textarea-text-color); font-size: 0.95rem; transition: all 0.3s ease; flex-grow: 1; background-color: #fff; } textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px var(--shadow-color); }
    .tab-navigation { display: flex; justify-content: space-between; margin-top: 30px; } .nav-button { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 10px 20px; background-color: var(--blue-accent); color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; touch-action: manipulation; } .nav-button:hover { background-color: #6baae0; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); } .nav-button.prev { background-color: #aaa; box-shadow: 0 4px 8px rgba(170, 170, 170, 0.3); } .nav-button.prev:hover { background-color: #888; box-shadow: 0 6px 12px rgba(136, 136, 136, 0.4); } .nav-button.invisible { visibility: hidden; }
    .fab-container { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 100; } .fab { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 10px 15px; color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; transition: all 0.3s ease; width: auto; min-width: 120px; height: 40px; text-align: center; touch-action: manipulation; } .fab:hover { transform: translateY(-2px) scale(1.05); } .save-button-local { background-color: var(--accent-color); box-shadow: 0 4px 10px var(--shadow-color); } .save-button-local:hover { box-shadow: 0 6px 12px var(--shadow-color); } .download-button { background-color: var(--blue-accent); box-shadow: 0 4px 10px rgba(125, 185, 238, 0.3); } .download-button:hover { box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); } .upload-button { background-color: var(--green-accent); box-shadow: 0 4px 10px var(--green-shadow); } .upload-button:hover { box-shadow: 0 6px 12px var(--green-shadow); } .clear-button { background-color: var(--error-color); box-shadow: 0 4px 10px var(--error-shadow); } .clear-button:hover { background-color: #d96a6a; box-shadow: 0 6px 12px var(--error-shadow); } #fileInput { display: none; }
    .notification { position: fixed; bottom: 190px; right: 20px; background-color: var(--accent-color); color: white; padding: 12px 20px; border-radius: 8px; font-size: 0.9rem; box-shadow: 0 4px 10px var(--shadow-color); transform: translateY(190px); opacity: 0; transition: transform 0.4s ease-out, opacity 0.4s ease-out; z-index: 99; pointer-events: none; } .notification.upload-success { background-color: var(--green-accent); color: #333; box-shadow: 0 4px 10px var(--green-shadow); } .notification.error { background-color: var(--error-color); box-shadow: 0 4px 10px var(--error-shadow); } .notification.info { background-color: var(--info-color); box-shadow: 0 4px 10px var(--info-shadow); } .notification.show { transform: translateY(0); opacity: 1; }
    /* --- Check Actions (Review Button Only) --- */
    .check-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 2rem; margin-bottom: 1.5rem; }
    .check-actions button { padding: 10px 20px; color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
    .check-actions button:hover { transform: translateY(-2px); }
    #reviewButton { background-color: var(--green-accent); color: #333; box-shadow: 0 4px 8px var(--green-shadow); }
    #reviewButton:hover { background-color: #6bcdac; box-shadow: 0 6px 12px var(--green-shadow); }
    /* --- Review Summary --- */
    #review-summary-container { display: none; margin-top: 2rem; padding: 25px; background-color: var(--review-bg); border: 1px solid var(--review-border); border-radius: 15px; box-shadow: 0 4px 10px rgba(251, 220, 142, 0.2); color: var(--textarea-text-color); } .review-section { margin-bottom: 20px; } .review-section:last-child { margin-bottom: 0; } .review-section-title { font-size: 1.3rem; font-weight: 500; color: var(--text-color); margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed var(--accent-color); display: flex; align-items: center; gap: 8px; } .review-content { font-size: 0.95rem; line-height: 1.7; white-space: pre-wrap; word-wrap: break-word; background-color: rgba(255, 255, 255, 0.5); padding: 10px; border-radius: 8px; border: 1px solid rgba(238, 125, 155, 0.1); } .review-content.asis-item { margin-bottom: 10px; border-left: 3px solid var(--accent-color); padding-left: 15px; } .review-content.asis-item strong { display: block; font-weight: 500; margin-bottom: 5px; color: var(--text-color); opacity: 0.9; } .review-content.placeholder-text { color: var(--placeholder-color); font-style: italic; }
    /* --- Generate Image Button Wrapper --- */
    #generate-image-btn-wrapper { display: none; text-align: center; margin-top: 1.5rem; margin-bottom: 1.5rem; }
    #generate-image-btn { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 10px 20px; color: white; border: none; border-radius: 30px; font-family: 'Zen Maru Gothic', sans-serif; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; touch-action: manipulation; background-color: var(--blue-accent); box-shadow: 0 4px 8px rgba(125, 185, 238, 0.3); }
    #generate-image-btn:hover { background-color: #6baae0; box-shadow: 0 6px 12px rgba(125, 185, 238, 0.4); transform: translateY(-2px); }
    #generate-image-btn:disabled { background-color: #aaa; cursor: not-allowed; transform: none; box-shadow: none; color: #eee; }
    /* --- Image Output --- */
    #review-image-container {
        display: none;
        text-align: center;
        margin-top: 1.5rem;
        background-color: #fff;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        /* === ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ã®å¹…ã‚’åˆ¶é™ã—ä¸­å¤®æƒãˆ === */
        max-width: 600px; /* ã“ã®å€¤ã‚’èª¿æ•´ã—ã¦ãŠå¥½ã¿ã®ã‚µã‚¤ã‚ºã« */
        margin-left: auto;
        margin-right: auto;
        /* ==================================== */
    }
    #review-image {
        max-width: 100%; /* ã‚³ãƒ³ãƒ†ãƒŠã«åˆã‚ã›ã¦ç¸®å° */
        border: 1px solid var(--border-color);
        border-radius: 10px;
        margin-bottom: 1rem;
        vertical-align: middle; /* ç”»åƒä¸‹ã®éš™é–“å¯¾ç­– */
    }
    #review-image-container p { font-size: 0.9rem; margin-top: 1rem; color: var(--text-color); opacity: 0.9; line-height: 1.5; }
    /* Container for only the Tweet button */
    .output-actions { text-align: center; margin-top: 1.5rem; }
    #tweet-btn { display: inline-block; margin: 0; padding: 10px 20px; background-color: #1DA1F2; color: white; border-radius: 30px; text-decoration: none; font-size: 1rem; font-family: 'Zen Maru Gothic', sans-serif; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(29, 161, 242, 0.3); }
    #tweet-btn:hover { background-color: #0c85d0; box-shadow: 0 6px 12px rgba(29, 161, 242, 0.4); transform: translateY(-2px); }
    /* --- Styles for #capture-temp-container (Review Summary Only) --- */
    #capture-temp-container { all: initial; font-family: 'Zen Maru Gothic', sans-serif !important; line-height: 1.6 !important; box-sizing: border-box !important; position: absolute !important; left: -9999px !important; top: 0 !important; width: 800px !important; padding: 25px !important; background-color: #fef9e7 !important; border: 1px solid #fbdc8e !important; border-radius: 15px !important; box-shadow: 0 4px 10px rgba(251, 220, 142, 0.2) !important; overflow: hidden !important; color: #555 !important; }
    #capture-temp-container * { box-sizing: border-box !important; font-family: inherit !important; line-height: inherit !important; color: inherit !important; background-color: transparent !important; }
    #capture-temp-container .review-section { margin-bottom: 20px !important; } #capture-temp-container .review-section:last-child { margin-bottom: 0 !important; }
    #capture-temp-container .review-section-title { font-size: 1.3rem !important; font-weight: 500 !important; color: #ee7d9b !important; margin-bottom: 10px !important; padding-bottom: 5px !important; border-bottom: 1px dashed #f5aac0 !important; display: flex !important; align-items: center !important; gap: 8px !important; }
    #capture-temp-container .review-content { font-size: 0.95rem !important; line-height: 1.7 !important; white-space: pre-wrap !important; word-wrap: break-word !important; background-color: rgba(255, 255, 255, 0.5) !important; padding: 10px !important; border-radius: 8px !important; border: 1px solid rgba(238, 125, 155, 0.1) !important; color: #555 !important; }
    #capture-temp-container .review-content pre { font-family: inherit !important; margin: 0 !important; white-space: pre-wrap !important; word-wrap: break-word !important; color: inherit !important; background-color: transparent !important; }
    #capture-temp-container .review-content.asis-item { margin-bottom: 10px !important; border-left: 3px solid #f5aac0 !important; padding-left: 15px !important; }
    #capture-temp-container .review-content.asis-item strong { display: block !important; font-weight: 500 !important; margin-bottom: 5px !important; color: #ee7d9b !important; opacity: 0.9 !important; }
    #capture-temp-container .review-content.placeholder-text { color: #999 !important; font-style: italic !important; }

    /* --- Responsive Styles --- */
    @media (max-width: 768px) { body { padding: 15px; padding-bottom: 160px; } /* ... other responsive styles ... */ #capture-temp-container { width: 90% !important; padding: 20px !important; } #capture-temp-container .review-section-title { font-size: 1.2rem !important; } #capture-temp-container .review-content { font-size: 0.9rem !important; } #review-image-container { max-width: 90%; } /* Allow image container to shrink */ }
    @media (max-width: 480px) { body { padding-bottom: 200px; } /* ... other responsive styles ... */ .fab span { display: none; } .fab { min-width: 40px; width: 40px; height: 40px; border-radius: 50%; padding: 0; } .notification { width: calc(100% - 30px); left: 15px; right: 15px; text-align: center; bottom: 210px; } }
</style>
</head>
<body>
<div class="container">
    <!-- Header, Storage Note, Progress Bar, Tabs Navigation (unchanged) -->
    <div class="header"> <h1>ğŸŒ€ ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«</h1> <p>è‡ªå·±åˆ†æã¨è¡Œå‹•è¨­è¨ˆã®ãŸã‚ã®ã‚µã‚¤ã‚¯ãƒ«æ€è€ƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</p> </div>
    <div class="storage-note"> <p>âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ã¯é™å®šçš„ã«å‹•ä½œã—ã¾ã™ã€‚</p> <p>â€»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆå»ã•ã‚Œã¾ã™ã€‚</p> <p>å®Œå…¨ãªæ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆã¯ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚</p> </div>
    <div class="progress-container"> <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div> <div class="progress-labels"><span>ã‚µã‚¤ã‚¯ãƒ«é€²è¡ŒçŠ¶æ³</span><span id="progressText">0%</span></div> </div>
    <div class="tabs-nav" id="tabsNav"> <button class="tab-button active" data-tab="tobe">ğŸŒˆ <span>TO-BE</span></button> <button class="tab-button" data-tab="asis">ğŸ” <span>AS-IS</span></button> <button class="tab-button" data-tab="rule">âŒ <span>RULE</span></button> <button class="tab-button" data-tab="perk">ğŸ§° <span>PERK</span></button> <button class="tab-button" data-tab="action">ğŸ›  <span>ACTION</span></button> <button class="tab-button" data-tab="check">âœ… <span>CHECK</span></button> </div>
    <!-- Tab Content -->
    <div class="tab-content">
        <!-- TO-BE, AS-IS, RULE, PERK, ACTION Tabs (unchanged) -->
        <div class="tab-panel active" id="tobe-panel"> <h2 class="section-title">ğŸŒˆ TO-BEï¼ˆãªã‚ŠãŸã„å§¿ãƒ»ç†æƒ³ã®çŠ¶æ…‹ï¼‰</h2> <p class="section-description">ãƒ¯ã‚¯ãƒ¯ã‚¯ã§ãã‚‹æœªæ¥ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¾ã—ã‚‡ã†ã€‚ã‚ãªãŸã®ç›®æŒ‡ã—ãŸã„çŠ¶æ…‹ãƒ»ã‚ã‚ŠãŸã„å§¿ã¯ã©ã‚“ãªã‚‚ã®ã§ã™ã‹ï¼Ÿ</p> <div class="card tobe-card"> <h3 class="card-title">ç†æƒ³ã®çŠ¶æ…‹ã‚’æã</h3> <p class="card-subtitle">ç›®æ¨™ã§ã¯ãªãã€ã©ã‚“ãªé¢¨ã«ç”Ÿãã¦ã„ãŸã„ã‹ã€ã‚ã‚Šæ–¹ã‚’æã„ã¦ã¿ã‚ˆã†</p> <textarea data-section="tobe" id="tobe-input" placeholder="ã“ã‚“ãªãµã†ã«ç”ŸããŸã„ï¼ã©ã‚“ãªçŠ¶æ…‹ãŒç†æƒ³ï¼Ÿ"></textarea> </div> <div class="tab-navigation"> <button class="nav-button prev invisible">â—€ <span>å‰ã¸</span></button> <button class="nav-button next" data-next="asis"><span>æ¬¡ã¸</span> â–¶</button> </div> </div>
        <div class="tab-panel" id="asis-panel"> <h2 class="section-title">ğŸ” AS-ISï¼ˆç¾çŠ¶åˆ†æï¼‰</h2> <p class="section-description">ç¾çŠ¶ã‚’å¤šè§’çš„ã«æ£šå¸ã—ã¾ã—ã‚‡ã†ã€‚è‡ªåˆ†è‡ªèº«ã‚„ç’°å¢ƒã‚’å®¢è¦³çš„ã«è¦‹ã¤ã‚ã‚‹ã“ã¨ã§ã€æ¬¡ã®ä¸€æ‰‹ãŒè¦‹ãˆã¦ãã¾ã™ã€‚</p> <div class="asis-grid"> <div class="card"> <h3 class="card-title">ã€Œç†æƒ³ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ã€</h3> <p class="card-subtitle">ç†æƒ³ã¨æ¯”ã¹ã¦ä»Šã®è‡ªåˆ†ã¯ã©ã†ï¼Ÿ</p> <textarea data-section="asis" id="asis-gap" placeholder="ç†æƒ³ã¨æ¯”ã¹ã¦ã€ã©ã“ã§å¼•ã£ã‹ã‹ã£ã¦ã‚‹ï¼Ÿ"></textarea> </div> <div class="card"> <h3 class="card-title">ã€Œèª²é¡Œãƒ»ã¤ã¾ãšãã€</h3> <p class="card-subtitle">æœ€è¿‘ã—ã‚“ã©ã„ã“ã¨ãƒ»æ­¢ã¾ã£ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ</p> <textarea data-section="asis" id="asis-challenges" placeholder="ã©ã“ã§ã¤ã¾ãšã„ã¦ã‚‹ï¼Ÿä½•ãŒé›£ã—ã„ï¼Ÿ"></textarea> </div> <div class="card"> <h3 class="card-title">ã€Œæ„Ÿæƒ…ãƒ»ä¸å®‰ãƒ»ç„¦ã‚Šã€</h3> <p class="card-subtitle">ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã¦ã‚‹ã“ã¨ã¯ï¼Ÿ</p> <textarea data-section="asis" id="asis-emotions" placeholder="ãªã‚“ã¨ãªãä¸å®‰ãªã“ã¨ã€ã¼ã‚“ã‚„ã‚Šã§ã‚‚OKã§ã™"></textarea> </div> <div class="card"> <h3 class="card-title">ã€Œå¤–çš„ãªåˆ¶ç´„ã€</h3> <p class="card-subtitle">è‡ªåˆ†ã§ã¯å‹•ã‹ã›ãªã„ç’°å¢ƒè¦å› ã£ã¦ï¼Ÿ</p> <textarea data-section="asis" id="asis-constraints" placeholder="å‘¨ã‚Šã®çŠ¶æ³ã§å¤‰ãˆã‚‰ã‚Œãªã„ã“ã¨ã¯ï¼Ÿ"></textarea> </div> <div class="card"> <h3 class="card-title">ã€Œéå»ã®å½±éŸ¿ãƒ»ãƒˆãƒ©ã‚¦ãƒã€</h3> <p class="card-subtitle">æ˜”ã®çµŒé¨“ãŒä»Šã®è¡Œå‹•ã«å½±éŸ¿ã—ã¦ã‚‹ï¼Ÿ</p> <textarea data-section="asis" id="asis-past" placeholder="éå»ã®çµŒé¨“ã§ä»Šã‚‚å½±éŸ¿ã—ã¦ã‚‹ã“ã¨ã‚ã‚‹ï¼Ÿ"></textarea> </div> </div> <div class="tab-navigation"> <button class="nav-button prev" data-prev="tobe">â—€ <span>å‰ã¸</span></button> <button class="nav-button next" data-next="rule"><span>æ¬¡ã¸</span> â–¶</button> </div> </div>
        <div class="tab-panel" id="rule-panel"> <h2 class="section-title">âŒ RULEï¼ˆã‚„ã‚‰ãªã„ã“ã¨ãƒ»é¿ã‘ãŸã„æ–¹å‘ï¼‰</h2> <p class="section-description">è‡ªåˆ†ã‚’å®ˆã‚‹ãŸã‚ã®å¢ƒç•Œç·šã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚ã€Œã‚‚ã†ã“ã‚Œã¯ã‚„ã‚‰ãªã„ã€ã¨æ±ºã‚ã‚‹ã“ã¨ã§ã€åŠ¹ç‡çš„ã«å‰ã«é€²ã‚ã¾ã™ã€‚</p> <div class="card"> <h3 class="card-title">è‡ªåˆ†ã‚’å®ˆã‚‹è¨­è¨ˆ</h3> <p class="card-subtitle">ç„¡ç†ã—ãªã„ãŸã‚ã®"ã‚„ã‚‰ãªã„å®£è¨€"ã‚’æ›¸ã“ã†</p> <textarea data-section="rule" id="rule-input" placeholder="ã“ã‚Œã¯ã‚‚ã†ã‚„ã‚‰ãªã„ã€é¿ã‘ãŸã„ã“ã¨ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†"></textarea> </div> <div class="tab-navigation"> <button class="nav-button prev" data-prev="asis">â—€ <span>å‰ã¸</span></button> <button class="nav-button next" data-next="perk"><span>æ¬¡ã¸</span> â–¶</button> </div> </div>
        <div class="tab-panel" id="perk-panel"> <h2 class="section-title">ğŸ§° PERKï¼ˆä½¿ãˆã‚‹è£…å‚™ï¼‰</h2> <p class="section-description">ä»Šã®è‡ªåˆ†ãŒæŒã¤å¼·ã¿ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‚ã¾ã—ã‚‡ã†ã€‚æ—¢ã«æ‰‹ã«å…¥ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚„çµŒé¨“ã€äººè„ˆã‚‚å¤§åˆ‡ãªè£…å‚™ã§ã™ã€‚</p> <div class="card"> <h3 class="card-title">è‡ªåˆ†ã®è£…å‚™ã‚’è¦‹ã¤ã‚ã‚‹</h3> <p class="card-subtitle">ä»Šã®ã‚¹ã‚­ãƒ«ãƒ»çµŒé¨“ãƒ»çŸ¥è­˜ã‚’æ£šå¸ã—ã™ã‚‹</p> <textarea data-section="perk" id="perk-input" placeholder="ä»Šã®è‡ªåˆ†ã«ã‚ã‚‹æ­¦å™¨ã£ã¦ï¼Ÿä½¿ãˆã‚‹ã‚¹ã‚­ãƒ«ã¯ï¼Ÿ"></textarea> </div> <div class="tab-navigation"> <button class="nav-button prev" data-prev="rule">â—€ <span>å‰ã¸</span></button> <button class="nav-button next" data-next="action"><span>æ¬¡ã¸</span> â–¶</button> </div> </div>
        <div class="tab-panel" id="action-panel"> <h2 class="section-title">ğŸ›  ACTIONï¼ˆæ‰‹æ®µãƒ»è¡Œå‹•ï¼‰</h2> <p class="section-description">ç†æƒ³ã«è¿‘ã¥ããŸã‚ã®å…·ä½“çš„ãªä¸€æ­©ã‚’è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚TO-BEã«è¿‘ã¥ããŸã‚ã«ã€ä»Šã®è‡ªåˆ†ã«ã§ãã‚‹ã“ã¨ã¯ä½•ã§ã—ã‚‡ã†ï¼Ÿ</p> <div class="card"> <h3 class="card-title">æ¬¡ã®ä¸€æ‰‹ã‚’è€ƒãˆã‚‹</h3> <p class="card-subtitle">ç†æƒ³ã«è¿‘ã¥ããŸã‚ã«ä»Šã§ãã‚‹ã“ã¨ã¯ï¼Ÿ</p> <textarea data-section="action" id="action-input" placeholder="å…·ä½“çš„ã«ä½•ã‚’ã™ã‚‹ï¼Ÿã„ã¤ã¾ã§ã«ï¼Ÿã©ã†ã‚„ã£ã¦ï¼Ÿ"></textarea> </div> <div class="tab-navigation"> <button class="nav-button prev" data-prev="perk">â—€ <span>å‰ã¸</span></button> <button class="nav-button next" data-next="check"><span>æ¬¡ã¸</span> â–¶</button> </div> </div>
        <!-- CHECK Tab -->
        <div class="tab-panel" id="check-panel">
            <h2 class="section-title">âœ… CHECKï¼ˆæŒ¯ã‚Šè¿”ã‚Šï¼‰</h2>
            <p class="section-description">è¡Œå‹•ã®çµæœã‚’æŒ¯ã‚Šè¿”ã‚Šã€æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ãªã’ã¾ã—ã‚‡ã†ã€‚ã†ã¾ãã„ã£ãŸã“ã¨ã€æ”¹å–„ç‚¹ã€æ¬¡ã«è©¦ã—ãŸã„ã“ã¨ã‚’æ•´ç†ã—ã¾ã™ã€‚</p>
            <div class="card">
                <h3 class="card-title">KPTã§æŒ¯ã‚Šè¿”ã‚‹</h3>
                <p class="card-subtitle">Keepï¼Problemï¼Tryã§æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ãªã’ã‚ˆã†</p>
                <textarea data-section="check" id="check-input" placeholder="ã‚ˆã‹ã£ãŸã“ã¨(Keep)ï¼æ”¹å–„ç‚¹(Problem)ï¼æ¬¡ã«ã‚„ã£ã¦ã¿ã‚‹ã“ã¨(Try)"></textarea>
            </div>
            <!-- Action Buttons Area (Review Button Only) -->
            <div class="check-actions">
                <button id="reviewButton">ğŸ“ <span>å…¥åŠ›å†…å®¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼</span></button>
            </div>
            <!-- Review Summary Container -->
            <div id="review-summary-container"></div>
            <!-- Generate Image Button Wrapper (Initially hidden) -->
            <div id="generate-image-btn-wrapper">
                 <button id="generate-image-btn">ğŸ–¼ï¸ <span>ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’ç”»åƒåŒ–/ã‚³ãƒ”ãƒ¼</span></button>
            </div>
            <!-- Image Generation Output -->
            <div id="review-image-container">
                <img alt="ã®ã³ã—ã‚è¨˜éŒ²ãƒ¬ãƒ“ãƒ¥ãƒ¼" id="review-image" src=""/>
                <p id="image-save-instruction"></p>
                <!-- Container for only the Tweet button -->
                <div class="output-actions">
                     <a href="#" id="tweet-btn" target="_blank" rel="noopener noreferrer">ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹</a>
                </div>
            </div>
            <!-- Tab Navigation -->
            <div class="tab-navigation" style="margin-top: 2rem;">
                <button class="nav-button prev" data-prev="action">â—€ <span>å‰ã¸</span></button>
                <button class="nav-button next restart" data-next="tobe"><span>ã‚µã‚¤ã‚¯ãƒ«å†å§‹å‹•</span> ğŸ”„</button>
            </div>
        </div>
    </div> <!-- End Tab Content -->

    <!-- FABs, File Input, Notifications (unchanged) -->
    <div class="fab-container"> <button class="fab save-button-local" id="saveButtonLocal" title="ç¾åœ¨ã®å…¥åŠ›å†…å®¹ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã—ã¾ã™">ğŸ’¾ <span>ä¿å­˜(ï¾›ï½°ï½¶ï¾™)</span></button> <button class="fab download-button" id="downloadButton" title="ç¾åœ¨ã®å…¥åŠ›å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™">ğŸ’¾ <span>DL(ï¾Œï½§ï½²ï¾™)</span></button> <button class="fab upload-button" id="uploadButton" title="ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å…¥åŠ›å†…å®¹ã‚’èª­ã¿è¾¼ã¿ã¾ã™">ğŸ“¤ <span>UL(èª­è¾¼)</span></button> <button class="fab clear-button" id="clearButtonLocal" title="ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚ŒãŸå†…å®¹ã¨ç¾åœ¨ã®å…¥åŠ›ã‚’å…¨ã¦æ¶ˆå»ã—ã¾ã™">ğŸ—‘ï¸ <span>å…¨æ¶ˆå»</span></button> </div>
    <input type="file" id="fileInput" accept=".json">
    <div class="notification" id="saveNotificationLocal">ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸï¼</div> <div class="notification upload-success" id="uploadNotificationSuccess">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼</div> <div class="notification error" id="uploadNotificationError">ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div> <div class="notification info" id="clearNotification">å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚</div>

</div> <!-- End Container -->

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- Main Application Logic (unchanged from ver6.6) -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // --- Element References ---
    const tabsNav = document.getElementById('tabsNav'); const tabButtons = tabsNav.querySelectorAll('.tab-button'); const tabPanels = document.querySelectorAll('.tab-panel'); const textareas = document.querySelectorAll('textarea'); const saveButtonLocal = document.getElementById('saveButtonLocal'); const downloadButton = document.getElementById('downloadButton'); const uploadButton = document.getElementById('uploadButton'); const clearButtonLocal = document.getElementById('clearButtonLocal'); const fileInput = document.getElementById('fileInput'); const saveNotificationLocal = document.getElementById('saveNotificationLocal'); const uploadNotificationSuccess = document.getElementById('uploadNotificationSuccess'); const uploadNotificationError = document.getElementById('uploadNotificationError'); const clearNotification = document.getElementById('clearNotification'); const progressBar = document.getElementById('progressBar'); const progressText = document.getElementById('progressText'); const storageNote = document.querySelector('.storage-note');
    const generateBtn = document.getElementById('generate-image-btn');
    const generateBtnWrapper = document.getElementById('generate-image-btn-wrapper'); // Added reference
    const outputContainer = document.getElementById('review-image-container'); const outputImg = document.getElementById('review-image'); const tweetBtn = document.getElementById('tweet-btn'); const reviewButton = document.getElementById('reviewButton'); const reviewSummaryContainer = document.getElementById('review-summary-container'); const imageSaveInstruction = document.getElementById('image-save-instruction');
    // --- State Variables ---
    const tabOrder = ['tobe', 'asis', 'rule', 'perk', 'action', 'check']; const reviewSections = { 'tobe': { title: 'ğŸŒˆ TO-BEï¼ˆãªã‚ŠãŸã„å§¿ãƒ»ç†æƒ³ã®çŠ¶æ…‹ï¼‰', ids: ['tobe-input'] }, 'asis': { title: 'ğŸ” AS-ISï¼ˆç¾çŠ¶åˆ†æï¼‰', ids: ['asis-gap', 'asis-challenges', 'asis-emotions', 'asis-constraints', 'asis-past'] }, 'rule': { title: 'âŒ RULEï¼ˆã‚„ã‚‰ãªã„ã“ã¨ãƒ»é¿ã‘ãŸã„æ–¹å‘ï¼‰', ids: ['rule-input'] }, 'perk': { title: 'ğŸ§° PERKï¼ˆä½¿ãˆã‚‹è£…å‚™ï¼‰', ids: ['perk-input'] }, 'action': { title: 'ğŸ›  ACTIONï¼ˆæ‰‹æ®µãƒ»è¡Œå‹•ï¼‰', ids: ['action-input'] }, }; const storagePrefix = 'arumi_'; let currentTabIndex = 0; let isLocalStorageAvailable = true; let notificationTimeout;
    // --- Helper Functions ---
    function getLocalStorageKey(textareaElement) { const section = textareaElement.dataset.section; const id = textareaElement.id; if (section && id) return `${storagePrefix}${section}_${id}`; console.warn('Missing data-section or id:', textareaElement); return null; }
    function showNotification(element, duration = 2000) { if (notificationTimeout) clearTimeout(notificationTimeout); [saveNotificationLocal, uploadNotificationSuccess, uploadNotificationError, clearNotification].forEach(el => { if (el) el.classList.remove('show'); }); if (element) { element.classList.add('show'); notificationTimeout = setTimeout(() => element.classList.remove('show'), duration); } }
    // --- LocalStorage Functions ---
    function checkLocalStorage() { try { localStorage.setItem('__arumi_test__', '__test__'); localStorage.removeItem('__arumi_test__'); isLocalStorageAvailable = true; storageNote.style.display = 'none'; console.info('LocalStorage available.'); } catch (e) { isLocalStorageAvailable = false; storageNote.style.display = 'block'; console.warn('LocalStorage unavailable.'); if (saveButtonLocal) { saveButtonLocal.disabled = true; saveButtonLocal.style.opacity = 0.5; saveButtonLocal.style.cursor = 'not-allowed'; } if (clearButtonLocal) { clearButtonLocal.disabled = true; clearButtonLocal.style.opacity = 0.5; clearButtonLocal.style.cursor = 'not-allowed'; } } }
    function saveInputsToLocal() { if (!isLocalStorageAvailable) return false; let changed = false; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) { const current = localStorage.getItem(key); if (current !== ta.value) { localStorage.setItem(key, ta.value); changed = true; } } }); if (changed) console.log('Inputs saved to localStorage.'); return changed; }
    function restoreInputsFromLocal() { if (!isLocalStorageAvailable) return; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) { const saved = localStorage.getItem(key); if (saved !== null) ta.value = saved; } }); console.log('Inputs restored from localStorage.'); }
    function clearAllInputs() { if (!isLocalStorageAvailable) { textareas.forEach(ta => ta.value = ''); console.log('Textareas cleared (localStorage unavailable).'); return; } let keysToRemove = []; for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); if (key && key.startsWith(storagePrefix)) { keysToRemove.push(key); } } keysToRemove.forEach(key => localStorage.removeItem(key)); console.log('LocalStorage data cleared.'); textareas.forEach(ta => ta.value = ''); console.log('Textareas cleared.'); }
    // --- File Download/Upload Functions ---
    function getAllInputsData() { const data = {}; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key) data[key] = ta.value; }); return data; }
    function downloadDataAsFile() { const data = getAllInputsData(); const jsonData = JSON.stringify(data, null, 2); const blob = new Blob([jsonData], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; const ts = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-'); a.download = `nobishiro_cycle_data_${ts}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); console.log('Data downloaded.'); }
    function restoreInputsFromFileData(data) { let count = 0; textareas.forEach(ta => { const key = getLocalStorageKey(ta); if (key && data.hasOwnProperty(key)) { ta.value = data[key]; count++; } }); console.log(`Restored ${count} inputs from file.`); saveInputsToLocal(); }
    function handleFileUpload(event) { const file = event.target.files[0]; if (!file) return; if (file.type !== 'application/json') { showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'; fileInput.value = ''; return; } const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); restoreInputsFromFileData(data); showNotification(uploadNotificationSuccess, 2000); uploadNotificationSuccess.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼'; } catch (error) { console.error('File parse error:', error); showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚'; } finally { fileInput.value = ''; } }; reader.onerror = () => { console.error('File read error'); showNotification(uploadNotificationError, 3000); uploadNotificationError.textContent = 'ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'; fileInput.value = ''; }; reader.readAsText(file); }
    // --- UI Update Functions ---
    function updateProgress() { const progress = ((currentTabIndex + 1) / tabOrder.length) * 100; progressBar.style.width = `${progress}%`; progressText.textContent = `${Math.round(progress)}%`; }
    function showTab(tabId) { const targetIndex = tabOrder.indexOf(tabId); if (targetIndex === -1) { console.error(`Tab ID "${tabId}" not found.`); return; } currentTabIndex = targetIndex; tabButtons.forEach((button, index) => button.classList.toggle('active', index === currentTabIndex)); tabPanels.forEach((panel, index) => { const panelId = tabOrder[index]; if (panel.id === `${panelId}-panel`) panel.classList.toggle('active', index === currentTabIndex); }); updateProgress();
      outputContainer.style.display = "none"; outputImg.src = ""; reviewSummaryContainer.style.display = "none";
      if(generateBtnWrapper) generateBtnWrapper.style.display = 'none'; // Hide wrapper too
      generateBtn.textContent = 'ğŸ–¼ï¸ ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã‚’ç”»åƒåŒ–/ã‚³ãƒ”ãƒ¼'; generateBtn.disabled = false;
    }
    // --- Review Summary Function ---
    function displayReviewSummary() {
        saveInputsToLocal(); let summaryHTML = '';
        for (const sectionKey in reviewSections) { if (!reviewSections.hasOwnProperty(sectionKey)) continue; const sectionInfo = reviewSections[sectionKey]; let sectionContentHTML = ''; let sectionHasContent = false; if (sectionKey === 'asis') { let asisItemsHTML = ''; let asisHasActualContent = false; sectionInfo.ids.forEach(id => { const ta = document.getElementById(id); const card = ta ? ta.closest('.card') : null; const subtitle = card ? (card.querySelector('.card-subtitle')?.textContent || card.querySelector('.card-title')?.textContent || '') : ''; const value = ta ? ta.value.trim() : ''; const placeholder = ta ? ta.placeholder : ''; let displayValue = ''; let isPlaceholder = false; if (value) { displayValue = value; asisHasActualContent = true; } else if (placeholder) { displayValue = placeholder; isPlaceholder = true; } if (displayValue) { const contentClass = isPlaceholder ? 'review-content asis-item placeholder-text' : 'review-content asis-item'; asisItemsHTML += `<div class="${contentClass}"><strong>${subtitle.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</strong>${displayValue.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>`; sectionHasContent = true; } }); if (!asisHasActualContent && sectionHasContent) { sectionContentHTML = asisItemsHTML + `<div class="review-content placeholder-text">ï¼ˆâ†‘ä¸Šè¨˜ã¯å…¥åŠ›ä¾‹ã§ã™ï¼‰</div>`; } else if (!sectionHasContent) { sectionContentHTML += `<div class="review-content placeholder-text">ï¼ˆæœªå…¥åŠ›ï¼‰</div>`; } else { sectionContentHTML = asisItemsHTML; } } else { const ta = document.getElementById(sectionInfo.ids[0]); const value = ta ? ta.value.trim() : ''; const placeholder = ta ? ta.placeholder : ''; let displayValue = ''; let isPlaceholder = false; if (value) { displayValue = value; } else if (placeholder) { displayValue = placeholder; isPlaceholder = true; } else { displayValue = 'ï¼ˆæœªå…¥åŠ›ï¼‰'; isPlaceholder = true; } const contentClass = isPlaceholder ? 'review-content placeholder-text' : 'review-content'; sectionContentHTML += `<pre class="${contentClass}">${displayValue.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>`; if (value || placeholder) sectionHasContent = true; } summaryHTML += `<div class="review-section"><h4 class="review-section-title">${sectionInfo.title}</h4>${sectionContentHTML}</div>`; }
        reviewSummaryContainer.innerHTML = summaryHTML;
        reviewSummaryContainer.style.display = 'block';
        outputContainer.style.display = "none"; // Ensure image output is hidden initially
        if (generateBtnWrapper) { generateBtnWrapper.style.display = 'block'; } // Show generate button wrapper
        reviewSummaryContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        console.log('Review summary displayed.');
    }
    // --- Event Listeners ---
    tabButtons.forEach(button => button.addEventListener('click', () => { const id = button.dataset.tab; if (id) showTab(id); }));
    document.querySelectorAll('.nav-button').forEach(button => { button.addEventListener('click', () => { let nextTabId = null; const isNext = button.classList.contains('next'); const isPrev = button.classList.contains('prev'); const isRestart = button.classList.contains('restart'); if (isNext && !isRestart && currentTabIndex < tabOrder.length - 1) nextTabId = tabOrder[currentTabIndex + 1]; else if (isPrev && currentTabIndex > 0) nextTabId = tabOrder[currentTabIndex - 1]; else if (isRestart) nextTabId = tabOrder[0]; if (nextTabId) { showTab(nextTabId); const ct = document.querySelector('.container').offsetTop; window.scrollTo({ top: ct - 20, behavior: 'smooth' }); } }); });
    if (saveButtonLocal) saveButtonLocal.addEventListener('click', () => { if (isLocalStorageAvailable && saveInputsToLocal()) showNotification(saveNotificationLocal, 2000); });
    if (downloadButton) downloadButton.addEventListener('click', downloadDataAsFile);
    if (uploadButton && fileInput) uploadButton.addEventListener('click', () => fileInput.click());
    if (fileInput) fileInput.addEventListener('change', handleFileUpload);
    if (clearButtonLocal) { clearButtonLocal.addEventListener('click', () => { if (confirm('ç¾åœ¨å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å†…å®¹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã™ã¹ã¦æ¶ˆå»ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) { clearAllInputs(); showNotification(clearNotification, 2500); showTab(tabOrder[0]); } }); } else { console.error('Clear button not found.'); }
    let debounceTimer; textareas.forEach(ta => ta.addEventListener('input', () => { clearTimeout(debounceTimer); debounceTimer = setTimeout(saveInputsToLocal, 500); }));
    if (reviewButton) reviewButton.addEventListener('click', displayReviewSummary);

    // --- Generate Image Button Click (Captures ONLY review summary) ---
    if (generateBtn) {
        generateBtn.addEventListener('click', () => {
            if (reviewSummaryContainer.style.display !== 'block') { alert('å…ˆã«ã€Œå…¥åŠ›å†…å®¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚'); return; }
            const canWriteToClipboard = navigator.clipboard && typeof navigator.clipboard.write === 'function' && window.isSecureContext;
            if (!canWriteToClipboard) { alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯æ¥ç¶šç’°å¢ƒã§ã¯ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ç”»åƒã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\næ‰‹å‹•ã§ã®ä¿å­˜ãƒ»æ·»ä»˜ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ï¼ˆHTTPSæ¥ç¶šãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ï¼‰'); }
            saveInputsToLocal();
            generateBtn.textContent = 'ç”»åƒç”Ÿæˆä¸­...'; generateBtn.disabled = true;
            outputImg.src = ''; imageSaveInstruction.innerHTML = ''; // Clear previous output

            const tempContainer = document.createElement('div'); tempContainer.id = 'capture-temp-container';
            const clonedReview = reviewSummaryContainer.cloneNode(true); clonedReview.style.display = 'block'; clonedReview.id = ''; tempContainer.appendChild(clonedReview);
            document.body.appendChild(tempContainer);

            const options = { scale: window.devicePixelRatio || 1.5, useCORS: true, backgroundColor: '#fef9e7', logging: false, scrollX: 0, scrollY: -window.scrollY, windowWidth: tempContainer.scrollWidth, windowHeight: tempContainer.scrollHeight };

            setTimeout(() => {
                 html2canvas(tempContainer, options).then(canvas => {
                     const dataURL = canvas.toDataURL("image/png", 0.95);
                     outputImg.src = dataURL;
                     outputContainer.style.display = "block"; // Show the output container

                     const tweetText = "ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ #ã‚ã‚‹ã¿å¼ã®ã³ã—ã‚ã‚µã‚¤ã‚¯ãƒ«";
                     tweetBtn.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;

                     if (canWriteToClipboard) { try { canvas.toBlob(async (blob) => { if (!blob) throw new Error("Canvas to Blob conversion failed."); try { await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]); if (imageSaveInstruction) imageSaveInstruction.innerHTML = `âœ… ç”»åƒã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼<br/>ãƒ„ã‚¤ãƒ¼ãƒˆç”»é¢ã‚’é–‹ãã€<strong>Ctrl+V (Cmd+V)</strong> ã§ç”»åƒã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚<br/><small>(ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ãŸå ´åˆã¯ä¸‹ã®ç”»åƒã‚’ä¿å­˜ã—ã¦æ‰‹å‹•ã§æ·»ä»˜ã—ã¦ãã ã•ã„)</small>`; console.log('Image copied to clipboard.'); } catch (err) { console.error('Failed to copy image to clipboard:', err); if (imageSaveInstruction) imageSaveInstruction.innerHTML = `ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br/>ğŸ“² <strong>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜</strong> ã—ã€<br/>ãƒ„ã‚¤ãƒ¼ãƒˆã«æ·»ä»˜ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚<br/>ğŸ’» PC: <strong>å³ã‚¯ãƒªãƒƒã‚¯ â†’ åå‰ã‚’ã¤ã‘ã¦ç”»åƒã‚’ä¿å­˜</strong>`; } }, 'image/png'); } catch (e) { console.error("Error generating blob for clipboard:", e); if (imageSaveInstruction) imageSaveInstruction.innerHTML = `ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã€‚<br/>ğŸ“² <strong>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜</strong> ã—ã€<br/>ãƒ„ã‚¤ãƒ¼ãƒˆã«æ·»ä»˜ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚<br/>ğŸ’» PC: <strong>å³ã‚¯ãƒªãƒƒã‚¯ â†’ åå‰ã‚’ã¤ã‘ã¦ç”»åƒã‚’ä¿å­˜</strong>`; } } else { if (imageSaveInstruction) imageSaveInstruction.innerHTML = `ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼éå¯¾å¿œ/éæ¨å¥¨ç’°å¢ƒã§ã™ã€‚<br/>ğŸ“² <strong>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜</strong> ã—ã€<br/>ãƒ„ã‚¤ãƒ¼ãƒˆã«æ·»ä»˜ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚<br/>ğŸ’» PC: <strong>å³ã‚¯ãƒªãƒƒã‚¯ â†’ åå‰ã‚’ã¤ã‘ã¦ç”»åƒã‚’ä¿å­˜</strong>`; }
                     outputContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                     generateBtn.textContent = 'ğŸ–¼ï¸ ç”»åƒã‚’å†ç”Ÿæˆ/ã‚³ãƒ”ãƒ¼';
                 }).catch(error => {
                     console.error('html2canvas failed:', error);
                     alert('ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nå†…å®¹ãŒè¤‡é›‘ã™ãã‚‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã€ã¾ãŸã¯äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\n(è©³ç´°: ' + error.message + ')');
                     generateBtn.textContent = 'ğŸ”„ ç”»åƒç”Ÿæˆå†è©¦è¡Œ';
                     outputContainer.style.display = "none"; // Hide output on error
                     if (imageSaveInstruction) imageSaveInstruction.innerHTML = `ç”»åƒç”Ÿæˆã‚¨ãƒ©ãƒ¼ã€‚<br/>ğŸ“² <strong>ç”»åƒã‚’é•·æŠ¼ã—ã—ã¦ä¿å­˜</strong> ã—ã€<br/>ãƒ„ã‚¤ãƒ¼ãƒˆã«æ·»ä»˜ã—ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚<br/>ğŸ’» PC: <strong>å³ã‚¯ãƒªãƒƒã‚¯ â†’ åå‰ã‚’ã¤ã‘ã¦ç”»åƒã‚’ä¿å­˜</strong>`;
                 }).finally(() => {
                     if (document.body.contains(tempContainer)) { document.body.removeChild(tempContainer); }
                     generateBtn.disabled = false;
                 });
            }, 250);
        });
    } else { console.error('Generate image button not found.'); }

    // --- Initial Setup ---
    checkLocalStorage();
    restoreInputsFromLocal();
    showTab(tabOrder[0]);
  });
</script>

</body>
</html>
